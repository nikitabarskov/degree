%!TEX engine = xelatex
%%% !TEX encoding = UTF-8 Unicode

\documentclass[a4paper, 14pt, oneside]{extarticle}

\include{preambule}

\begin{document}

    \thispagestyle{empty}
    \begin{center}
    МИНИСТЕРСТВО НАУКИ И ВЫСШЕГО ОБРАЗОВАНИЯ \\
    РОССИЙСКОЙ ФЕДЕРАЦИИ\vspace{14pt} \\
    федеральное государственное автономное \\
    образовательное учреждение высшего образования \\
    <<Самарский национальный исследовательский университет \\
    имени академика С.П. Королева>> \\
    (Самарский университет)\vspace{28pt} \\
    Институт информатики, математики и электроники \\
    Факультет информатики \\
    Кафедра информационных систем и технологий\vspace{28pt} \\
    \begin{flushright}
        На правах рукописи
    \end{flushright}
    \begin{flushleft}
        УДК 004.832.3
    \end{flushleft}
    Барсков Никита Максимович \vspace{14pt} \\
    ПРОГНОЗИРОВАНИЕ ВЗАИМОДЕЙСТВИЙ ПОЛЬЗОВАТЕЛЕЙ С РЕКЛАМНЫМИ ЭЛЕМЕНТАМИ ИНТЕРНЕТ-СТРАНИЦ \vspace{14pt} \\
    \onehalfspacing{}
    Автореферат \\
    выпускной квалификационной работы магистра \\
    по направлению подготовки 09.04.01 Информатика \\
    и вычислительная техника \\
    (уровень магистратуры) \\
    профиль «Data Analysis and Software Assurance» \\
    («Анализ данных и управление качеством программного обеспечения»)\vfill
    \end{center}
    \begin{center}
    Самара -- 2019
    \end{center}

    \newpage
    \noindent Работа выполнена в Самарском университете на кафедре информационных систем и технологий.
    \\

    \noindent Научный руководитель: к.т.н., доцент Куликовских И.М.
    \\

    \noindent Рецензент: к.т.н. Графкин А.В.
    \newpage


    \structuresection{ОБЩАЯ ХАРАКТЕРИСТИКА РАБОТЫ}

    История интернет-рекламы берет свое начало 3 мая 1978, когда маркетолог компании DEC (Digital Equipment Corporation) 
    Гари Серк (Gary Thuerk) впервые отправил письмо американским пользователям сети ARPANET, содержащее приглашение
    на демонстрацию модели нового компьютера DEC-20~\autocite{online:spam}.

    За 30 лет развития системы доставки рекламного содержимого в сети Интернет эволюционировали из простых рассылочных
    приложений в современные комплексы, реализующие разнообразные способы доставки рекламного содержимого до 
    конечного пользователя~\autocite{online:google}.

    Требования к системам реализации рекламного содержимого, такие как обработка запросов в реальном времени, 
    поддержка широкой аудитории пользователей, персонализация рекламного содержимого способствуют развитию
    передовых способов обработки разнородных и неструктурированных данных, появлению новых алгоритмов, разработке
    необходимых сетевой и вычислительной инфраструктур для хранения, извлечения и передачи информации.

    В настоящее время доставка рекламного контента до конечного пользователя является сложным многоэтапным процессом, 
    определяющим какой конкретный экземпляр рекламы будет показан пользователю в зависимости от его местоположения,
    используемых им устройства и программного обеспечения для выхода во Всемирную сеть, истории предыдущих
    посещений и прочей известной о пользователе информации.

    Алгоритмическая реклама (англ. Programmatic Advertising) является наиболее современным способом реализации 
    рекламного содержимого. Принцип алгоритмической рекламы сводится к гранулярности и автоматизации. Гранулярность
    обеспечивает быструю обработку доставки рекламного содержимого в реальном времени, позволяет оценивать и ранжировать
    стоимость показа и создает условия для оптимизации бюджетной эффективность всех сторон, участвующих в процессе 
    реализации рекламного содержимого. Автоматизация открывает двери для детализированной работы с каждым событием доставки,
    позволяя персонализировать и актуализировать рекламное содержимое для конечного пользователя.

    Прогнозирование взаимодействий пользователей с рекламным содержимым интернет страниц является необходимым этапом
    в оценке прибыльности процесса реализации рекламного содержимого. На основе предположения о 
    пользовательском поведении, параметры кампаний могут быть исправлены для достижения большей
    финансовой эффективности.

    Существующие методы прогнозирования взаимодействий пользователей с рекламными элементами
    интернет-страниц являются проприетарной собственностью компаний разработчиков, и не представляется
    возможным проанализировать алгоритм прогноза существующих систем без доступа к кодовой базе.

    Наиболее известным методом решения подобной задачи является наивное прогнозирование и его сезонная
    модификация, которая отличается простотой реализации и хорошим качеством на ограниченном наборе
    данных. 

    В данной работе описан алгоритм решения задачи прогнозирования взаимодействия пользователей с рекламным 
    содержимым интернет-страниц. Проведена оценка качества полученного решения в сравнении с существующим методом
    наивного сезонного прогнозирования (Na\"{i}ve seasonal forecasting). 

    Целью работы является разработка алгоритма прогнозирования взаимодействий пользователей с рекламным содержимым
    интернет-страниц и оценка качества работы разработанного решения.

    В соответсвии с поставленной целью решается набор задач, а именно:
    \begin{enumerate}
        \item анализ процесса взаимодействия пользователей с рекламными элементами интернет-страниц;
        \item математическая постановка задачи прогнозирования;
        \item разработка алгоритма прогнозирования взаимодействий пользователей;
        \item программная реализация разработанного алгоритма;
        \item оценка качества работы разработанного алгоритма в сравнении с существующим 
        методом наивного сезонного прогнозирования.
    \end{enumerate}

    Методы исследования, используемые в выпускной квалификационной работе магистра, основаны на положениях
    теории вероятностей и математической статистики, методах машинного обучения, принципах обработки больших данных
    и парадигмам объектно-ориентировнного и функционального программирования.

    Научная новизна работы заключается в построении математической модели для описания, обработки и прогнозирования
    метрик, используемых в области алгоритмической рекламы и предназначенных для количественного анализа пользователей.

    Практическая ценность работы заключается в разработке программного комплекса, решающего следующие задачи:
    \begin{enumerate}
        \item обработка и агрегация исходного протокола рекламной сети, независимо от типа рекламной сети;
        \item решения задачи прогнозирования пользовательских взаимодействий.
    \end{enumerate}

    Положения, выносимые на защиту:
    \begin{enumerate}
        \item математическое описание алгоритма прогнозирования взаимодействий пользователей с рекламными элементами интернет-страниц;
        \item вычислительная система, реализующая описанный алгоритм прогнозирования;
        \item результаты численных экспериментов прогнозирования взаимодействий и оценка качества работы алгоритма.
    \end{enumerate}

    Апробация работы произведена в рамках компании Максифайер, которая использует результаты
    данной выпускной квалификационной работы при разработке собственных продуктов.
    \\
    
    \structuresection{СОДЕРЖАНИЕ РАБОТЫ}
    
    Во введении показана актуальность выполненной работы, поставлены цели и задачи исследования и разработки.

    В первой главе приводится описание предметной области алгоритмической рекламы, даются определения
    используемых понятий данной области, дано математическое описание метрик, используемых
    для количественного описания пользовательских взаимодействий, описаны используемые математические модели при построении решения.

    Алгоритмическая реклама --- это способ автоматизированной реализации цифрового рекламного содержимого,
    например, рекламного содержимого интернет-страниц, в режиме реального времени, основанный на индивидуальных 
    особенностях каждого отдельного события доставки~\autocite*[]{online:programmatic}.
    \input{inc/images/rtb}
    На рисунке~\ref{img:pragrammatic-advertising} отображена схема одной из моделей алгоритмической рекламы
    RTB (англ. Real-Time Bidding, покупка в реальном времени).

    Рекламный элемент (англ. Advertising Unit) --- набор элементов интернет-страницы, предназначенный для 
    отображения рекламного содержимого и предоставления возможности взаимодействия с ним.

    Взаимодействие пользователя с рекламным элементом (Impression) --- событие просмотра пользователем содержимого
    рекламного элемента интернет-страницы, сопровождающееся сбором с согласия пользователя сведений, передаваемых 
    системам алгоритмической рекламы.

    Число взаимодействий (Impressions amount) --- число взаимодействий пользователей с конкретным рекламным элементом
    интернет-страницы, осуществленных за определенный период времени.

    Основным источником данных о взаимодействиях пользователей с рекламными элементами элементами интернет-страниц (информация
    о пользовательском траффике, пользовательском поведении) является протокол работы системы реализации рекламного 
    содержимого.

    Представим каждое взаимодействие пользователя с рекламными элементыми в виде вектора $\symbf{U}_i$, элементами $u_n$
    которого являются признаки взаимодействия. Тогда выражение \eqref{eq:impressions-base-definition} содержит формализованное
    описание каждого взаимодействия
    \begin{equation}
        \symbf{U_i} = \left(u_0, \dots, u_n \right),
        i = \overline{1, M},
        n = \overline{0, N},
        u_n \in D_n,
        \label{eq:impressions-base-definition}
    \end{equation}
    \setlength{\tabcolsep}{0em}\begin{tabular}{@{\hspace*{0em}}m{\parindent}ll}
        где & $M$ & {---} общее число взаимодействий; \\
        & $N$ & {---} число признаков; \\
        & $D_n$ & {---} множество допустимых значений признака $u_n$. \\
    \end{tabular}
    \medskip

    Если один и признаков векторов является временным отсчетом, тогда множество векторов
    $\symbf{U_i}$ представляет собой временной ряд и выражение \eqref{eq:impressions-base-definition} можно переписать в виде
    \begin{equation}
        \symbf{U_i} = \left(t_k, u_1, \dots, u_n \right),
        \; i = \overline{1, M},
        \; n = \overline{1, N},
        \; k = \overline{1, K},
        \; u_n \in D_n,
        \label{eq:impression-base-with-time}
    \end{equation}
    \setlength{\tabcolsep}{0em}\begin{tabular}{@{\hspace*{0em}}m{\parindent}ll}
        где & $M$ & {---} общее число взаимодействий; \\
        & $N$ & {---} число признаков; \\
        & $K$ & {---} число временных отсчетов; \\
        & $D_n$ & {---} множество допустимых значений признака $u_n$. \\
    \end{tabular}
    \medskip

    Выражение \eqref{eq:user-imps-definition}
    определяет функцию взаимодействия пользователя $U$ с рекламным элементом $A$ в момент времени $t_k$
    \begin{equation}
        \text{Imps} \left( U, A, t_k, \left\{ \symbf{U} \right\} \right) =
            \begin{cases}
                1,\; u_i = U \wedge u_j = A  \\
                0,\; u_i \neq U \vee u_j \neq A
            \end{cases},
            \; \forall t_k \in \left[ T_0, T_1 \right],
        \label{eq:user-imps-definition}
    \end{equation}
    \setlength{\tabcolsep}{0em}\begin{tabular}{@{\hspace*{0em}}m{\parindent}ll}
        где & $U$ & {---} идентификатор пользователя; \\
        & $A$ & {---} идентификатор рекламного элемента; \\
        & $t_k$ & {---} временной отсчет времени взаимодействия; \\
        & $\left\{ \symbf{U} \right\}\;$ & {---} исходная выборка пользователей. \\
    \end{tabular}
    \medskip

    Для получения метрики количества взаимодействий пользователя $U$ с рекламным элементом $A$ за период $\left[T_0, T_1\right]$
    необходимо просуммировать значения функции \eqref{eq:user-imps-definition} по времени
    \begin{equation}
        \text{Imps} \left( U, A, T_0, T_1, \left\{ \symbf{U} \right\} \right) =
        \sum \limits_{t=T_0}^{T_1} \text{Imps} \left( U, A, t, \left\{ \symbf{U} \right\} \right),
        \label{eq:user-period-imps-definition}
    \end{equation}
    \setlength{\tabcolsep}{0em}\begin{tabular}{@{\hspace*{0em}}m{\parindent}ll}
        где & $U$ & {---} идентификатор пользователя; \\
        & $A$ & {---} идентификатор рекламного элемента; \\
        & $T_0$ & {---} нижняя граница временного периода; \\
        & $T_1$ & {---} верхняя граница временного периода; \\
        & $\left\{ \symbf{U} \right\}\;$ & {---} исходная выборка пользователей. \\
    \end{tabular}
    \medskip

     Для получения прогнозов данных метрик и протокола работы рекламной системы рассматриваются методы машинного обучения и задача прогнозирования
     временного ряда, а также методы статистики. 

     Машинное обучение (Machine Learning) --- раздел исскуственного интеллекта, изучающий методы и алгоритмы обучения,
    особенностью которых является не прямое аналитическое решение задачи, а обучение на основе накопленного опыта решений
    сходных задач.

    Временной ряд (Time Series) --- набор характеристик некоторого процесса, собранных в различные моменты времени.

    Прогнозирование (Forecasting) --- задача предсказания характеристик процесса в будущем на основе имеющейся статистике
    о данном процессе.
    В общем случае задачу прогнозирования можно поставить следующим образом ~\autocite{ml:forecasting}:
    \begin{equation}
        \hat{y}_{\left.T+h\right|T} = F\left(y_0, \dots, y_T\right),
    \end{equation}
    \setlength{\tabcolsep}{0em}\begin{tabular}{@{\hspace*{0em}}m{\parindent}ll}
        где & $\hat{y}_{\left.T+h\right|T}\;$ & {---} оценка прогноза; \\
        & $F$ & {---} функция прогноза; \\
        & $y_i$ & {---} известные значения процесса. \\
    \end{tabular}
    
    Основная идея получения калиброванных статистических оценок представляет собой
    расчет калиброванных весов выборки при условия ограничения вида: сумма весов первоначального плана выборки и сумма
    калиброванных весов -- равны. Калибровка обеспечивает простой практический подход к включению вспомогательной информации
    в оценку.

    Пусть дана конечная совокупность $\Omega = \left\{1, 2, \dots, i, \dots, N \right\}$ из $N$ наблюдений из которой выполнена
    вероятностная выборка $s, s\in\Omega$ размера $n$, получена с вероятностью $p(s)$ в соответствии с планом выборки $p$.
    Вероятности включения объекта в выборку  $\pi_i = \text{Pr}\left( i \in s\right)$ известны.

    Для производимой калибровки важно точно определить вспомогательную информацию. Метод оценивания с помощью обобщенной
    регрессии (англ. GREG, generalized regression estimation) есть систематизированный способ принять во внимание
    вспомогательную информацию.

    Простая линейная оценка GREG-оценка описывается и в и ее центральная идея заключается
    в том, что предсказанные $\hat{y}_i$ могут быть вычислены для всех $N$ совокупности, с помощью подобранной вспомогательной
    модели и использовании вспомогательных значений $x_i$.

    Сумма $Y = \sum\limits_{i \in \Omega} y_i$ определяется в \eqref{eq:strat-greg}:
    \begin{equation}
        \hat{Y}_{\text{GREG}} = \sum\limits_{\Omega}\hat{y}_i + \sum\limits_{s}d_i\left(y_i - \hat{y}_i\right)
        \label{eq:strat-greg}
    \end{equation}
    \setlength{\tabcolsep}{0em}\begin{tabular}{@{\hspace*{0em}}m{\parindent}ll}
        где & $y_i\;$ & {---} интересующая переменная; \\
        & $\hat{y}_i\;$ & {---} оценка интересующей переменной; \\
        & $d_i$ & {---} калибровочный вес. \\
    \end{tabular}

    Во второй главе приводится описание разрабатываемого алгоритма. Итоговым результатом работы алгоритма прогнозирования взаимодействий пользователей с рекламными элементами
    интернет-страниц является прогноз протокола работы рекламной системы. На вход алгоритму предполагается
    подача известно протокола работы рекламной системы и параметр, отвечающий за период прогнозирования. 

    Структурно алгоритм представляет собой следующие стадии
    \begin{enumerate}
        \item проведение выборки взаимодействий пользователей из начальной совокупности наблюдений (известный протокол
        работы рекламной системы);
        \item получение метрик количества взаимодействий и количества уникальных пользователей из начальной совокупности 
        наблюдений;
        \item построение прогноза протокола работы рекламной системы на основе выборки и полученной статистики метрик;
        \item построение прогноза метрик количества взаимодействий и количества уникальных пользователей на основе 
        полученной статистики метрик;
        \item проведение калибровочного процесса для прогноза протокола работы рекламной системы и прогноза метрик количества
        взаимодействий и количества уникальных пользователей.
    \end{enumerate}

    Третья глава посвящена реализации алгоритма прогнозирования взаимодействий пользователей с рекламными элементами
    интернет-страниц. Обосновывается выбор языка программирования, используемых библиотек и программного окружения
    для запуска приложения. Приводятся диаграммы потока данных и классов.

    Диаграмма потока данных (англ. Data Flow Diagram, DFD) -- методология визуализации потока данных, используемых или
    порождаемых в процессе работы системы.

    \input{inc/images/dataflowchartinit}

    Диаграмма классов -- структурная диаграмма языка моделирования UML, предназначенная для демонстрации иерархии классов,
    их композиций и отношений, членов класса (атрибутов и методов). Каждый элемент диаграммы классов представляет собой
    ячейку, содержащую три компоненты:
    \begin{enumerate}
        \item имя класса, пишется жирным шрифтом по центру ячейки (в случае если класс абстрактный, начертание должно быть жирным
        и курсивным);
        \item атрибуты класса, выравненивание по левому краю;
        \item методы класса, выравненивание по левому краю.
    \end{enumerate}

    В случае данной работы, в качестве классов для реализации функциональности стадий используются 6 классов стадий, каждый
    из которых имеет публичный метод \texttt{run}, выполнящий запуск стадии и обработку данных, детали которой определяются
    конкретной имплементацией метода. Стадии имеют доступ к хранилищу данных благодаря полю \texttt{provider}. Параметризация
    стадий достигается путем введения специлизированных полей в классы, так для стадии калибровки класс \texttt{CalibrationStage}
    включает поля границ решения СЛАУ \texttt{left\_border} и \texttt{right\_border} и точность решения \texttt{tolerance}. Класс
    \texttt{DataProvider} реализует функциональность чтения-записи данных. 

    Диаграмма классов, используемых при реализации системы изображена
    на рисунке~\eqref{img:uml}.
    \input{inc/images/uml}

    В качестве языка программирования, используемого для программной реализации алгоритма прогнозирования взаимодействий пользователей
    с рекламными элементами интернет-страниц, используется язык программирования Python. Язык разработан в начале 90-ых годов
    XX века нидерландским инженером Гвидо ван Россумом и до сих пор активно развивается (актуальная мажорная версия на апрель 
    2019 года 3.7).

    В качестве библиотеки, реализующей принцип ETL используется свободно распространяемая
    система обработки разнородных и слабоструктурированных данных Apache Spark, разработанная канадско-румынским специалистом
    Матеем Захария.

    В качестве хранилища данных, изображенных на диаграмме ~\ref{img:dataflowchartinit} используется система
    Apache Hadoop.

    Для управления ресурсами вычислительной системы, используемой для работы алгоритма 
    прогнозирования взаимодействий пользователей с рекламными элементами интернет-страниц
    используется система Apache Mesos.

    Содержание четвертой главы определяет результаты численных экспериментов. В качестве исходных данных используется протокол работы рекламной системы, который содержит данные о взаимодействиях
    пользователей одной рекламной сети. Исходные данные обфусцированы и не содержат информации, представляющей
    персональные данные пользователей интернет-страницы.

    Общее описание исходных данных представлено в таблице \ref{tab:source-data-review}.
    \newpage
    \setlength\LTleft{0pt}
    \setlength\LTright{0pt}
    \begin{longtable}{@{\extracolsep{\fill}}|x{0.45\textwidth}|x{0.45\textwidth}|}
            \caption{Общее описание исходных данных} \label{tab:source-data-review} \tn
            \hline
            Параметр исходных данных & Значение\tn\hline
            \endfirsthead
            \caption*{Продолжение таблицы~\thetable}\tn\hline 
            Параметр исходных данных & Значение\tn\hline
            \endhead
            Общее число взаимодействий & $1,28 \times 10^{11}$ \tn\hline
            Среднее число взаимодействий в день & $ 2,3 \times 10^5 $ \tn\hline
            Среднее число уникальных пользователей в день & $ 8,5 \times 10^4 $ \tn\hline
            Число уникальных элементов & 1525 \tn\hline
    \end{longtable}

    Так как целью разработки алгоритма прогнозирования взаимодействий пользователей с рекламными элементами интернет-страниц
    было повышение качества конечного прогноза, необходимо оценить результат работы алгоритма прогнозирования
    на различных наборах данных.

    Для определения средней абсолютной ошибки прогноза метрики воспользуемся выражением для
    средней абсолютной ошибки
    \begin{equation}
        \text{MAE} = \text{mean}\left( \left| e_t \right| \right),\; t = \overline{N+1, T}.
    \end{equation}
    и среднеквадратичной ошибки
    \begin{equation}
        \text{RMSE} = \sqrt{\text{mean}\left( e_t^2 \right)},\; t = \overline{N+1, T}.
    \end{equation}

    Для оценки качества прогноза воспользуемся определением функции относительной ошибки
    \begin{equation}
        p_t = \dfrac{e_t}{y_t}.
    \end{equation}

    Тогда выражение для относительной средней ошибки будет выглядеть следующим образом
    \begin{equation}
        \text{MAPE} = \text{mean}\left( \left| p_t \right| \right),\; t = \overline{N+1, T}.
    \end{equation}

    В качестве визуальной оценки качества прогноза используется диаграмма рассеяния.

    В качестве экспериментов было рассмотрено прогнозирование с использованием исходных 
    данных с 1 марта 2018 года по 28 февраля 2019 года.

    Анализ гистограмм распределения абсолютной ошибки на рисунке~\ref{img:1-3-mae} показывает, что новый алгоритм прогнозирует значение метрики взаимодействий пользователей с
    рекламными элементами интернет-страниц точнее, чем существующий наивный сезонных прогноз.
    \newpage
    \input{inc/images/1-3dayshist}
    \medskip
    \input{inc/images/1-1day}

    В заключении подводятся итоги выполнения работы и вывод по результатам исследования.
    \newpage
    \structuresection{Основные выводы и результаты}
    \begin{enumerate}
        \item в соответствии с полученным заданием был произведен обзор и анализ предметной области
алгоритмической рекламы, рассмотрены метрики оценки пользовательского поведения и определена
их математическая форма записи, произведен обзор существующих методов решения данной проблемы и
методов, используемых при построении алгоритма;

    \item перед построением алгоритма, была сформулирована задача, построена модульная математическая модель, 
    целью которой является построение прогнозов взаимодействий пользователей, для имплементации 
    данной модели были проанализированы и выбраны необходимые средства разработки и библиотеки;

    \item разработанный метод протестирован методами обратного тестирования на основе реальных данных.
    Для оценки качества работы алгоритма было произведено сравнение с существующим методом наивного
    сезонного прогнозирования;

    \item результаты работы данного алгоритма показывают, что разработанный программный комплекс решает
    поставленную задачу точнее, чем существующий метод;

    \item реализация алгоритма произведена при помощи современных библиотек с открытым
    исходным кодом, что делает разработанное решение легко поддерживаемым и обслуживаемым 
    средством решения поставленной задачи.
    \end{enumerate}
\end{document}