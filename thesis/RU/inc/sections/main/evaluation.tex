\section{Численные экперименты прогнозирования}
\subsection{Описание исходных данных}
В качестве исходных данных используется протокол работы рекламной системы, который содержит данные о взаимодействиях
пользователей одной рекламной сети. Исходные данные обфусцированы и не содержат информации, представляющей
персональные данные пользователей интернет-страницы.

Общее описание исходных данных представлено в таблице \ref{tab:source-data-review}.
\setlength\LTleft{0pt}
\setlength\LTright{0pt}
\begin{longtable}{@{\extracolsep{\fill}}|x{0.45\textwidth}|x{0.45\textwidth}|}
        \caption{Общее описание исходных данных} \label{tab:source-data-review} \tn
        \hline
        Параметр исходных данных & Значение\tn\hline
        \endfirsthead
        \caption*{Продолжение таблицы~\thetable}\tn\hline 
        Параметр исходных данных & Значение\tn\hline
        \endhead
        Общее число взаимодействий & $1,28 \times 10^{11}$ \tn\hline
        Среднее число взаимодействий в день & $ 2,3 \times 10^5 $ \tn\hline
        Среднее число уникальных пользователей в день & $ 8,5 \times 10^4 $ \tn\hline
        Число уникальных элементов & 1525 \tn\hline
\end{longtable}

График метрики общего числа взаимодействий пользователей~\eqref{eq:net-impressions-def} для периода снятия результатов в 1 день,
построенный на обработанных данных предоставленного протокола работы рекламной системы представлен на рисунке~\ref{img:network-impressions}.
\input{inc/images/network.tex}

Для вероятностной выборки значение вероятности $\pi$ выбрано исходя из вычислительной мощности ЭВМ и предполагаемой оценке времени
построения прогноза (3--4 часа) и равно 0,001. Верхняя и нижняя границы решения калибровочной системы линейный уравнений выбраны 500 и 1500
согласно требованиям предметной области и снижения влияния выбросов в исходных данных.

Для построения графика спектральной плотности используется временной ряд разностей первого порядка, представленный выражением \eqref{eq:firstdiffs}.
Данное действие необходимо для удаления трендовой составляющей из исходной статистики процесса.
\begin{equation}
    \Delta y (t) = y\left(t\right) - y\left(t-1\right).
    \label{eq:firstdiffs}
\end{equation}

Спектральный анализ исходных данных, использованный в при построении прогноза изображен на рисунке~\ref{img:spectraldensity}.
Очевидны гармоники 7 дневной сезонности (частота $\approx 0.14\;\text{дня}^{-1}$). 
\input{inc/images/fourierdataset}

\subsection{Методика оценки качества алгоритма прогнозирования}
Так как целью разработки алгоритма прогнозирования взаимодействий пользователей с рекламными элементами интернет-страниц
было повышение качества конечного прогноза, необходимо оценить результат работы алгоритма прогнозирования
на различных наборах данных.

Было произведено 3 численных эксперимента, при проведении которых производилась вариация параметров прогноза, таких как
дата прогноза, число исходных данных и длительность прогноза.

Для определения качества алгоритма прогнозирования взаимодействий пользователей с рекламными элементами интернет-страниц
производится сравнение метрики количества взаимодействий пользователей с отдельно взятыми рекламными 
элементами \eqref{eq:adunit-impressions} для собранной статистики (реальных значений) с оценкой прогноза данной метрики,
полученной при помощи разработанной модели прогнозирования.

Для измерения точности прогноза используется следующий подход~\autocite{eval:metrics}. Пусть известно реальное значение процесса (в нашем случае
реальное значение метрики \eqref{eq:adunit-impressions} или метрики \eqref{eq:net-impressions-def}) $y_1, \dots, y_T$.
Разделим исходные сведения о процессе на набор данных для обучения $y_1, \dots, y_N$ и набор данных для оценки прогноза 
$y_{N+1}, \dots, y_T$. Пусть $\hat{y}_{t+h}$ оценка прогноза процесса для периода прогнозирования $h$, а $y_{t+h}$ -- реальное
значение процесса в момент времени $t+h$, тогда можно ввести абсолютную ошибку прогноза, как 
\begin{equation}
    e_t = y_t - \hat{y}_t,\; t = \overline{N+1, T}.
\end{equation}

Для определения средней абсолютной ошибки прогноза метрики~\eqref{eq:net-impressions-def} воспользуемся выражением для
средней абсолютной ошибки
\begin{equation}
    \text{MAE} = \text{mean}\left( \left| e_t \right| \right),\; t = \overline{N+1, T}.
\end{equation}
и среднеквадратичной ошибки
\begin{equation}
    \text{RMSE} = \sqrt{\text{mean}\left( e_t^2 \right)},\; t = \overline{N+1, T}.
\end{equation}

Для оценки качества прогноза метрики~\eqref{eq:adunit-impressions} и~\eqref{eq:net-impressions-def} воспользуемся определением функции
ошибки
\begin{equation}
    p_t = \dfrac{e_t}{y_t}.
\end{equation}

Тогда выражение для относительной средней ошибки будет выглядеть следующим образом
\begin{equation}
    \text{MAPE} = \text{mean}\left( \left| p_t \right| \right),\; t = \overline{N+1, T}.
\end{equation}

В качестве визуальной оценки качества прогноза используется диаграмма рассеяния~\autocite{eval:scatter}.

\subsection{Численные эксперименты построения прогноза}

В качестве экспериментов было рассмотрено прогнозирование с использованием исходных 
данных с 1 марта 2018 года по 28 февраля 2019 года. Прогноз был построен на 1 день (на 1 марта 2019 года),
на 3 дня (на период с 1 марта 2019 года по 3 марта 2019 года) и на 7 дней (на период с 1 марта 2019 года
по 7 марта 2019 года).

Визуальная оценка диаграммам рассеяния, изображенных на рисунках~\ref{img:scatter1-1},~\ref{img:scatter1-3}
и~\ref{img:scatter1-7}, позволяет установить, что алгоритм обеспечивает лучшую точность,
чем наивный сезонный подход. Такой вывод сделан на основе числа отсчетов, попадающих в область 
относительной ошибки 0,1 и 0,2.

Анализ гистограмм распределения абсолютной ошибки на рисунках~\ref{img:1-1-mae},~\ref{img:1-3-mae} и~\ref{img:1-7-mae}
показывает, что новый алгоритм прогнозирует значение метрики взаимодействий пользователей с
рекламными элементами интернет-страниц точнее, чем существующий наивный сезонных прогноз. Однако,
разработанный алгоритм не лишен недостатков, которые подтверждаются растующие столбцы гистограммы
аболютной ошибки в некоторых случаях.

Аналогичный вывод можно сделать и на основе анализа гистограмм распределения относительной ошибки
на рисунках~\ref{img:1-1-mape},~\ref{img:1-3-mape} и~\ref{img:1-7-mape}.

Cредняя абсолютная ошибка, измеренная для каждого случая прогнозирования уменьшилась в среднем на $10\%$, а среднеквадратичная ошибка на $20\%$.
\medskip
\input{inc/images/1-1day}
\input{inc/images/1-3days}
\input{inc/images/1-7days}
\input{inc/images/1-1dayhist}
\input{inc/images/1-3dayshist}
\input{inc/images/1-7dayshist}
\input{inc/images/1-1dayhistmape}
\input{inc/images/1-3dayshistmape}
\input{inc/images/1-7dayshistmape}
