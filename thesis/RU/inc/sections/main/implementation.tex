\section{Проектирование и реализация системы прогнозирования взаимодействий пользователей с рекламными элементами \mbox{интернет-страниц}}
\subsection{Cтруктура разрабатываемой системы}
\subsubsection{Определение потока данных разрабатываемой системы}
Для определения структуры разрабатываемой автоматизированной системы, реализующей алгоритм прогнозирования взаимодействий
пользователей с рекламными элементами интернет-страниц для начала определим диаграмму потока данных, используемых при
построении прогноза.

Диаграмма потока данных (англ. Data Flow Diagram, DFD) -- методология представления потока данных, используемых или
пораждаемых в процессе или системе. Такой способ визуализации был следствием развития одного из класса UML диаграм
диаграмм деятельности (англ. Activity Diagram)~\autocite{impl:ad}. В 70-ые годы прошлого столетия данная методология
приобрела большую популярность благодаря работе~\autocite{impl:dfd} коллектива под руководством Эдварда Йордана и
Ларри Константина.

Главное достоинство данного вида представления заключается в легком способе построения высокоуровневой абстракции
потока данных в разрабатываемой системе. Один из вариантов диаграммы потока данных является нотация 
Йордана~\autocite{impl:yourdan}, для которой определены следующие компоненты:
\begin{enumerate}
    \item процесс (функция, трансформация) требуется для представления каким образом система обрабатывает 
    входные данные, на диаграмме изображается в виде круга с текстом, кратко описывающем детали обработки;
    \item хранилище определяет коллекцию данных в состоянии покоя (отсутствия процесса обработки над данными),
    на диаграмме изображается двумя параллельными отрезками и текстом, кратко характеризующим тип хранилища и
    коллекцию данных; 
    \item терминаторы представляют собой внешние объекты, с которыми взаимодействует система, графически представлены
    в виде прямоугольника;
    \item поток визуализирует порядок перехода данных от одного процесса или хранилища к другому процессу или
    хранилищу, на диаграмме изображается при помощи однонаправленной стрелки.
\end{enumerate}

При построении начального приближения диаграммы потока данных разрабатываемой системы прогнозирования взаимодействий
пользователей с рекламными элементами интернет-страниц воспользуемся блок схемой алгоритма на 
рисунке~\ref{img:algo-flowchart}.

Входными данными, использумыми в процессе работы разрабатываемой системы, является протокол работы рекламной системы.
Процессами для обработки данных будут являться процессы простроения вероятностной выборки и статистики метрик,
прогноза метрик и протокола работы и калибровочный процесс. В качестве хранилища должна выступать файловая система
вычислительной машины, на которой запущена система. Высокоуровневая диаграмма потока данных разрабатываемого приложения
представлена на рисунке ~\ref{img:dataflowchartinit}.
\input{inc/images/dataflowchartinit}

\subsubsection{Диаграмма классов разрабатываемой системы}
В соответствиии с диаграммой потока данных, изображенной на рисунке~\ref{img:dataflowchartinit} представим поток обработки
в виде следуюших стадий:
\begin{enumerate}
    \item предварительная обработка исходного протокола с целью приведения к виду, приемлимому для дальнейшего использования;
    \item проведение вероятностной выборки взаимодействий из предобработанного протокола работы;
    \item построение статистики метрик количества взаимодействий и количества уникальных пользователей на основе данных
    из предобработанного протокола работы;
    \item построение прогноза протокола работы рекламной системы на основе выборки и статистики;
    \item построение прогнозов метрик количества взаимодействий и количества уникальных пользователей на основе собранной
    статистики;
    \item проведение калибровочного процесса;
    \item построение итогового прогноза протокола работы рекламной системы.
\end{enumerate}

Для реализации данных стадий разработан набор классов, каждый из которых обеспечивает необходимую функциональность и
возможность параметризации. Для доступа к хранилищу реализован класс, обеспечивающий функциональность чтения--записи
исходных и порождаемых в процессе работы системы данных. Для визуализации описания классов, их атрибутов и 
методов используется диаграмма классов (англ. Static Structure Diagram),

Диаграмма классов -- структурная диаграмма языка моделирования UML, предназначенная для демонстрации иерархии классов,
их композиций и отношений, членов класса (атрибутов и методов)~\autocite{impl:ad}. Каждый элемент диаграммы классов представляет собой
ячейку, содержащую три компоненты:
\begin{enumerate}
    \item имя класса, пишется жирным шрифтом по центру ячейки (в случае если класс абстрактный, начертание должно быть жирным
    и курсивным);
    \item атрибуты класса, выравненивание по левому краю;
    \item методы класса, выравненивание по левому краю.
\end{enumerate}

В случае данной работы, в качестве классов для реализации функциональности стадий используются 6 классов стадий, каждый
из которых имеет публичный метод \texttt{run}, выполнящий запуск стадии и обработку данных, детали которой определяются
конкретной имплементацией метода. Стадии имеют доступ к хранилищу данных благодаря полю \texttt{provider}. Параметризация
стадий достигается путем введение специлизированных полей в классы, так для стадии калибровки класс \texttt{CalibrationStage}
включает поля границ решения СЛАУ \texttt{left\_border} и \texttt{right\_border} и точность решения \texttt{tolerance}. Класс
\texttt{DataProvider} реализует функциональность чтения-записи данных. 

Диаграмма классов, используемых при реализации системы изображена
на рисунке~\eqref{img:uml}.
\input{inc/images/uml}

\subsection{Выбор и обоснование комплекса программных средств}
\subsubsection{Язык программирования Python}

В качестве языка программирования, используемого для программной реализации алгоритма прогнозирования взаимодействий пользователей
с рекламными элементами интернет-страниц, используется язык программирования Python. Язык разработан в начале 90-ых годов
XX века нидерландским инженером Гвидо ван Россумом и до сих пор активно развивается (актуальная мажорная версия на апрель 
2019 года 3.7). Выбор языка Python обсуловлен следующими факторами:
\begin{enumerate}
    \item язык программирования Python поддерживает множество парадигм программирования (функциональное, объектно-ориентированное,
    императивное и т.д.);
    \item синтаксис и лексика языка программирования Python минималастична, следование стандарту языка программирования 
    (англ. Python Enhancement Proposals, PEP)~\autocite{impl:pep} позволяет писать легко читаемый код и повышает 
    производительность разработчика;
    \item Python занимает 4 место в рейтинге языков программирования TIOBE~\autocite{impl:rating}, отражающем популярность 
    языка программирования среди разработчиков;
    \item для языка программирования Python реализовано огромное число свободно распространяемых библиотек различной 
    направленности (машинное обучение, анализ и обработка данных, реализация методов вычислетельной математики и 
    т.д.)~\autocite{impl:awesome-python}.
\end{enumerate}

\subsubsection{Система распределенной работы с данными Apache Spark и библиотека обработки данных Pandas}

Данные, получаемые непосредственно от рекламной системы, представляют собой набор файлов, описывающих протокол работы
рекламной системы за определенный период времени (англ. bucket, partition). Такой подход, 
называемый партиционированием~\autocite{impl:partioning}, призван повысить скорость обработки и доступность
данных данных. Каждая партиция может содержать от нескольких тысяч до миллионов записей о взаимодействиях, размер
партиции может составлять от нескольких десятков мегабайт до сотен гигабайт в зависимости от структуры данных,
и формата файла. Подобный набор исходной информации требует использования универсального средства обработки, способного
быстро обрабатывать и агрегировать необходимыю информацию.

Подход к обработке данных, при котором данные проходят цикл загрузки, обработки и агрегации называется принцип ETL 
(англ. extract-transform-load). В качестве библиотеки, реализующей принцип ETL используется свободно распространяемая
система обработки разнородных и слабоструктурированных данных Apache Spark, разработанная канадско-румынским специалистом
Матеем Захария~\autocite{impl:spark}.

Система Apache Spark имеет необходимый интерфейс взаимодействия для языка программирования Python под названием PySpark.
Логика обработки данных, реализованная программистом при помощи системы Apache Spark, преобразуется в граф выполнения,
вершинами которого являются элементарные операции чтения, записи, преобразования, фильтрации, объединения. 
Данные, проходящие, через вершины графа выполнения, представляют собой распределенные коллекции примитивов (англ. Resilient
Distributed Dataset) или типизированные распределенные коллекции объектов (англ. Dataset). Таким образом, система
Apache Spark обеспечивает принципы ленивого распределенного выполнения, акцентруя разработчика только на написании
логики обработки данных.

Apache Spark поддерживают работу как на локальной машине (англ. standalone), так и разворачивается в системах
оркестрирования вычислительных ресурсов.

Для отслеживания работы программы, использующей Apache Spark, реализован интерфейс визуализации  Apache Spark UI, 
представляющий собой сервис, в котором можно отследить количество операций, объем обрабатываемых данных, количество
выделяемых ресурсов и прочие параметры, небходимые для диагностики работы приложения. Вид сервиса диагностики Apache
Spark UI изображен на рисунке~\ref{img:spark}.
\input{inc/images/spark}