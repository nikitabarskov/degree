\subsection{Алгоритмическая покупка рекламы}
\subsubsection{Основные термины и понятия}

Алгоритмическая реклама --- это способ автоматизированной реализации цифрового рекламного содержимого,
например, рекламного содержимого интернет-страниц, в режиме реального времени, основанный на индивидуальных 
особенностях каждого отдельного события доставки. (Oliver Busch Editor Programmatic Advertising)
\input{inc/images/rtb}

На рисунке~\ref{img:pragrammatic-advertising} отображена схема одной из моделей реализации алгоритмической рекламы
RTB (англ. Real-Time Bidding, покупка в реальном времени). При посещении пользователем интернет ресурса с рекламным
элементом, интернет-обозреватель собирает доступную о пользователе информацию (cookie информацию, техническую информацию об 
устройстве, местоположении) и отправляет запрос в систему SSP (уведомляет SSP о возможности показа рекламного
содержимого на рекламном элементе интернет-страницы пользователю).

SSP (англ. Supply Side Platform) --- комплекс аппаратных и программных средств, предназначенных для продажи 
рекламного места.

Рекламный элемент (англ. Advertising Unit) --- набор элементов интернет-страницы, предназначенный для 
отображения рекламного содержимого и предоставления возможности взаимодействия с ним.

SSP на основании переданной интернет-обозревателем информации объявляет данный рекламный элемент как доступный для 
продажи на аукционе. Следующим шагом, является уведомление рекламодателей через DSP о возможности покупки
данного рекламного места.

DSP (англ. Demand Side Platform) --- комплекс аппаратных и программных средств, предназначенных для предоставления
рекламного содержимого для дальнейшей продажи.

DSP осуществляют ставки на данное рекламное место и, выбирает из предложенных рекламодателями рекламных содержимых,
содержимое для показа. Критерий для отбора содержимого  при этом оценивая пользователя на основе предоставленной
SSP информацией и дополняя информацию о пользователе из внешних источников (DMP (Data Managment Platform) --- 
систем управления данными). На конечном этапе рекламное содержимое победителя аукциона доставляется через SSP и
интернет-обозреватель конечному пользователю путем показа на рекламном месте (рекламном элементе).

Взаимодействие пользователя с рекламным элементом (Impression) --- событие просмотра пользователем содержимого
рекламного элемента интернет-страницы, сопровождающееся сбором с согласия пользователя сведений, передаваемых 
системам алгоритмической рекламы.

Число взаимодействий (Impressions amount) --- число взаимодействий пользователей с конкретным рекламным элементом
интернет-страницы, осуществленных за определенный период времени.

Число уникальных пользователей (Uniques amount) --- число неповторяющихся пользователей, осуществивших взаимодействие
с конкретным рекламным элементом интернет-страницы за определенный период времени.

\subsubsection{Количественная оценка взаимодействий пользователей с рекламными элементами}

Основным источником данных о пользовательских посещениях интернет-страниц (информация о пользовательском траффике,
пользовательском поведении) является протокол работы системы продажи-покупки рекламного содержимого. Протокол работы
представляет собой файл или совокупность файлов, в котором содержатся данные о взаимодействиях пользователей с
рекламным содержимым интернет-страниц в хронологическом порядке. Чаще всего каждое взаимодействие описывается информацией,
собранной интернет-обозревателем, информацией, полученной из внешних источников, и набором технических
мета-данных, сгенерированных в процессе розыгрыша рекламного места.  Пример формата данных, содержащихся в данном 
протоколе, описан в таблице \ref{tab:feature-description}.
\setlength\LTleft{0pt}
\setlength\LTright{0pt}
\begin{longtable}{@{\extracolsep{\fill}}|x{0.2\textwidth}|x{0.4\textwidth}|x{0.3\textwidth}|}
        \caption{Описание признаков взаимодействия} \label{tab:feature-description} \tn
        \hline
        Название признака & Описание & Множество допустимых значений\tn\hline
        \endfirsthead
        \caption*{Продолжение таблицы~\thetable}\tn\hline
        Название поля & Описание & Множество допустимых значений\tn\hline
        \endhead
        Идентификатор пользователя
        & Уникальный идентификатор пользователя
        & Строка, генерируемая системой алгоритмической рекламы\tn\hline
        Идентификатор рекламного элемента
        & Уникальный идентификатор рекламного взаимодействия, с которым пользователь взаимодействовал
        & Целое число, генерируемое системой алгоритмической рекламы\tn\hline
        Время взаимодействия 
        & Время взаимодействия пользователя с рекламным элементом
        & Целое число\tn\hline
        Идентификатор географического положения пользователя 
        & Уникальный идентификатор географического положения пользователя
        & Целое число, генерируемое системой алгоритмической рекламы\tn\hline
        Идентификатор используемого обозревателя интернет-страниц 
        & Уникальный идентификатор интернет-обозревателя, используемого пользователем для
        взаимодействия с рекламным элементом
        & Целое число, генерируемое системой алгоритмической рекламы\tn\hline
        Идентификатор операционной системы
        & Уникальный идентификатор операционной системы устройства, при помощи которого пользователь совершил
        взаимодействие с рекламным элементом
        & Целое число, генерируемое системой алгоритмической рекламы\tn\hline
\end{longtable}
Для количественного описания пользовательского поведения служат метрики количества взаимодействий пользователей
с рекламным содержимым интернет-страниц и количества уникальных пользователей, взаимодействующий с рекламным
содержимым интернет-страниц.

Представим каждое взаимодействие пользователя с рекламными элементыми в виде вектора $\mathbf{U_i}$, элементами $u_n$
которого являются признаки взаимодействия (данные, содержащиеся в журнале работы рекламной системы). Тогда выражение
\eqref{eq:impressions-base-definition} содержит формализованное описание взаимодействия.
\begin{equation}
    \mathbf{U_i} = \left(u_0, \dots, u_n \right),\; i = \overline{1, M},\; n = \overline{0, N},\; u_n \in D_n
    \label{eq:impressions-base-definition}
\end{equation}
где $M$ -- общее число взаимодействий, содержащихся в исходном протоколе работы рекламной системы, $N$ -- число признаков
взаимодействия, $D_n$ -- множество допустимых значений признака $u_n$.

В таблице~\ref{tab:feature-description} указано, что одним из полей протокола работы рекламной системы является метка
времени взаимодействия. При этом различные события, например, взаимодействие различных пользователей с одним и тем же
рекламным элементом могут происходить в один и тот же момент времени. Тогда множество векторов $\mathbf{U_i}$ представляет 
собой многомерный временной ряд и выражение \eqref{eq:impressions-base-definition} можно переписать в виде
\begin{equation}
    \mathbf{U_i} = \left(t_k, u_1, \dots, u_n \right),
    \; i = \overline{1, M},
    \; n = \overline{1, N},
    \; k = \overline{1, K},
    \; u_n \in D_n
\end{equation}
где $M$ -- общее число взаимодействий, содержащихся в исходном протоколе работы рекламной системы, $N$ -- число признаков
взаимодействия, $K$ -- число временных отсчетов, $D_n$ -- множество допустимых значений признака $u_n$.

Пусть дана выборка пользователей $\left\{ \mathbf{U} \right\}$ за период времени $\left[T_0, T_1\right]$. Пусть $u_i$
элемент вектора взаимодействия $U$ содержит значение идентификатора пользователя, совершившего взаимодействие, а $u_j$ -- 
индентификатор рекламного элемента, с которым взаимодействие было совершено, тогда выражение \eqref{eq:user-imps-definition}
определяет функцию взаимодействия пользователя $U$ с рекламным элементом $A$ в момент времени $t_k$
\begin{equation}
    \text{Imps} \left( U, A, t_k, \left\{ \mathbf{U} \right\} \right) =
        \begin{cases}
            1, u_i = U \wedge u_j = A  \\
            0, u_i \neq U \vee u_j \neq A
        \end{cases}, \forall t_k \in \left[T_0, T_1\right]
    \label{eq:user-imps-definition}
\end{equation}

Для получения метрики количества взаимодействий пользователя $U$ с рекламным элементом $A$ за период $\left[T_0, T_1\right]$
необходимо просуммировать значения функции \eqref{eq:user-imps-definition} по времени
\begin{equation}
    \text{Imps} \left( U, A, T_0, T_1, \left\{ \mathbf{U} \right\} \right) =
    \sum \limits_{t=T_0}^{T_1} \text{Imps} \left( U, A, t, \left\{ \mathbf{U} \right\} \right) 
    \label{eq:user-period-imps-definition}
\end{equation}

Свойство аддитивности метрики количества взаимодействий с рекламным элементом позволяет строить набор производных метрик.
Выражение \eqref{eq:adunit-impressions} отражает количество взаимодействий всех взаимодействий с рекламным элементом $A$
и представляет собой сумму \eqref{eq:user-period-imps-definition} по всем пользователям
\begin{equation}
    \text{Imps} \left(A, T_0, T_1, \left\{ \mathbf{U} \right\} \right) =
    \sum \limits_{\forall u_i} \text{Imps} \left( u_i, A, T_0, T_1, \left\{ \mathbf{U} \right\} \right)
    \label{eq:adunit-impressions}
\end{equation}

Пример временного ряда, представленного метрикой количества взаимодействий c рекламным элементом показан на рисунке~\ref{img:impressions}.
\input{inc/images/impressions.tex}

Выражение \eqref{eq:net-impressions-def} отражает все пользовательские взаимодействия, для получения значения которых необходимо 
просуммировать \eqref{eq:adunit-impressions} по всем рекламным элементам
\begin{equation}
    \text{Imps} \left(T_0, T_1, \left\{ \mathbf{U} \right\} \right) =
    \sum \limits_{\forall u_j} \text{Imps} \left(u_j, T_0, T_1, \left\{ \mathbf{U} \right\} \right)
    \label{eq:net-impressions-def}
\end{equation}

Другой метрикой, количественно описывающей пользовательское поведение, является метрика количества уникальных пользователей,
взаимодействующих с рекламным элементом.

Пусть дана выборка пользователей $\left\{ \mathbf{U} \right\}$ за период времени $\left[T_0, T_1\right]$. Пусть $u_i$
элемент вектора взаимодействия $U$ содержит значение идентификатора пользователя, совершившего взаимодействие, а $u_j$ -- 
индентификатор рекламного элемента, с которым взаимодействие было совершено, тогда выражение \eqref{eq:uniques-definition}
метрика количества уникальных пользователей, взаимодействующих с рекламным элементом $A$
\begin{equation}
    \text{Distinct}\left( A, T_0, T_1, \left\{\mathbf{U}\right\} \right) =
    \begin{cases}
        \left|\left\{u_i\right\}\right|, u_j = A  \\
        0, u_j \neq A
    \end{cases}, \forall t_k \in \left[T_0, T_1\right],
    \label{eq:uniques-definition}
\end{equation}
где $\left|\left\{u_i\right\}\right|$ --- мощность множества уникальных пользователей, которые взаимодействовали с рекламным
элементом $A$ в момент времени $t_k$.

Пример временного ряда, представленного метрикой количества уникальных взаимодействий показан на 
рисунке~\ref{img:uniques}.
\input{inc/images/uniques}

Метрика количества уникальных взаимодействий пользователей не является аддитивной. Для построения общего числа уникальных
взаимодействий пользователей со всеми рекламными элементами необходимо использовать выражение \eqref{eq:net-uniques-definition}
\begin{equation}
    \text{Distinct}\left( T_0, T_1, \left\{\mathbf{U}\right\} \right) =\left|\left\{u_i\right\}\right| 
    \label{eq:net-uniques-definition}
\end{equation}

Кумулятивная сумма числа уникальных пользователей является метрикой, отражающей  пользовательский траффик. Рост данной
функции отражает увеличение числа посетителей сайта, обратно, уменьшение значения данной функции, отражает отток 
посетителей с интернет-страницы.

Пример временного ряда, представленного кумулятивной суммой количества уникальных взаимодействий показан на 
рисунке~\ref{img:cumsumuniques}.
\input{inc/images/cumsumuniques}