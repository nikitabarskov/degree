\subsection{Методы машинного обучения и анализ временных рядов}
\subsubsection{Основные термины и понятия}

Машинное обучение (Machine Learning) --- раздел исскуственного интеллекта, изучающий методы и алгоритмы обучения,
особенностью которых является не прямое аналитическое решение задачи, а обучение на основе накопленного опыта решений
сходных задач~\autocite{ml:definition}.

Временной ряд (Time Series) --- набор характеристик некоторого процесса, собранных в различные моменты времени.

Прогнозирование (Forecasting) --- задача предсказания характеристик процесса в будущем на основе имеющейся статистике
о данном процессе.

В данной работе рассматривается задача прогнозирования временных рядов, которая в общем случае сводится к задаче
обучения с учителем.

Обучение с учителем --- способ машинного обучения, при котором на основе известного опыта (обучающей выборки, набор
известных состояний и исходов) при помощи алгоритма машинного обучения восстанавливается закономерность между известным
состоянием системы и исходом. Общая постановка задачи может быть представлена следующим образом: на основе исходной
выборки $\left( \mathbf{x}_i \right), i = \overline{1, N}, \mathbf{x}_i \in X$ и известных исходов
$\left( \mathbf{y}_i \right), i = \overline{1, N}, \mathbf{y}_i \in Y$, найти отображение $f: X \rightarrow Y$

Период прогнозирования (Forecast Period) --- количество временных отсчетов, которые содержит прогноз.

\subsubsection{Задача прогнозирования}
В общем случае задача прогнозирования можно поставить следующим образом:
\begin{equation}
    \hat{y}_{\left.T+h\right|T} = F\left(y_0, \dots, y_T\right),
\end{equation}
где  $\hat{y}_{\left.T+h\right|T}$ -- оценка прогноза $y_{T+h}$ при известной статистике $y_0, \dots, y_T$,
$F$ -- функция прогноза~\autocite{ml:forecasting}.

Выбор функции $F$ определяется следующей последовательностью действий исследователя:
\begin{enumerate}
    \item При постановке задачи определяется какие цели преследует задача прогнозирования, кем и как прогноз будет 
    использован и каким требованиям должна соответствовать функция прогнозирования.
    \item Получение исходных данных, исходной статистики процесса, параметры которого требуется предсказать.
    \item Предварительный анализ данных, при котором графически оценивается исходных процесс (визуализация исходных 
    данных).
    \item На основании известной статистики, результатов предварительного исследования и требований к функции
    прогнозирования строится сравнение и прогноз модели прогноза и подбор ее параметров.
    \item На последнем шаге производится проверка модели на реальных данных (бэк-тестирование) и производится ее
    доработка.
\end{enumerate}

\subsubsection{Модель прогнозирования временных рядов Prophet}

Модель прогнозирования Prophet разработана командой по изучению данный в компании Facebook~\autocite{ml:prophet}. 
Она представляет собой модульную композицию различных методов машинного обучения~\autocite{ml:modularmodel}. В качестве базовой модели в Prophet используется декомпозиция исходного временного ряда
аддитивным выражением~\autocite{ml:tsrmodel} 
\begin{equation}
    y(t) = g(t) + s(t) + h(t) + \varepsilon(t),
\end{equation}
где $g(t)$ -- функция тренда (медленно меняющаяся компонента исходного временного ряда), $s(t)$ -- функция сезонности,
представляющая сезонные изменения временного ряда, $h(t)$ -- функция внешних событий (нерегулярных событий, имеющий влияние
на значение временного ряда), $\varepsilon(t)$ -- функция ошибки.

В качестве функции тренда $g(t)$ авторы предлагают использовать линейную модель с точками изменения, которая 
представляется в виде выражения, имеющего следующий вид:
\begin{equation}
    g(t) = \left( k + \mathbf{a}(t)^T \mathbf{\delta} \right)t + \left( m + \mathbf{a}(t)^T \mathbf{\gamma} \right)t,
\end{equation}
где $k$ -- степень роста, $\delta$ -- корректировка тренда в точках изменения, $\mathbf{a}(t)$ -- единичная функция 
изменения тренда, $m$ -- параметр сдвига, $\gamma$ -- слагаемое, необходимое для непрерывности функции тренда.

Точки изменения функция тренда задаются либо параметром модели (набор временных отсчетов, в которых, по мнению
исследователя, произошло измение тренда), либо автоматически определяются моделью. Так для ряда, изображенного на 
рисунке \ref{img:impressions} функция тренда имеет следующий вид, изображенный на рисунке \ref{img:trend}.
\input{inc/images/trend.tex}

Для определения функции сезонности $s(t)$ авторы используют разложение Фурье для построения модели, описывающей
периодические изменения времнного ряда.
\begin{equation}
    s(t) = \sum \limits_{n=1}^N \left( a_n \cos{\left( \dfrac{2\pi n t}{T} \right)} + b_n \sin{\left( \dfrac{2\pi n t}{T} \right)} \right),
    \label{eq:seasonality}
\end{equation}
где $a_n, \; b_n$ -- коэффициенты разложения Фурье, $T$ -- период сезонной компоненты.

На основе предположений о различных сезонностях в исходном временном ряду при помощи значения периода $T$ в выражении 
\eqref{eq:seasonality} возможно моделирование различных периодических компонент анализируемого процесса.

Сезонные компоненты ряда (с недельным и месячным периодами), изображенного на рисунке \eqref{img:impressions}, имеют вид, 
изображенный на рисунке \ref{img:seasonal}.
\input{inc/images/seasonal.tex}

Для построения функции внешних событий (например, выходные, праздники, крупные спортивные или политические события),
авторы предлагают построить индикаторную функцию следующего вида
\begin{equation}
    Z(t) = \left[ 1 (t \in D_1), \dots, 1 (t \in D_N)\right],
\end{equation}
где $D_i$ -- набор временных отсчетов, отосящихся в $i$-ому внешнему событию.
\begin{equation}
    h(t) = Z(t)\mathbf{k},
\end{equation}
где $\mathbf{k}$ -- корректировка значения временного ряда для внешнего события.

Компонента внешних событий временного ряда, изображенного на рисунке \eqref{img:impressions}, отражены на рисунке 
\eqref{img:holidays}.
\input{inc/images/holidays.tex}

Модель Prophet схожа с аддитивной моделью (GAM, generalized additive model)~\autocite{ml:gam}. Подобная модель
предоставляет ряд преимуществ, в сравнении с классом классических моделей ARIMA~\autocite{ml:forecastintro}:
\begin{enumerate}
    \item Модель Prophet является более гибкой и позволяет поддерживать одновремнно несколько периодов сезонности
    \item Отсчеты временного ряда могут быть распределены неравномерно во времени, поэтому нет необходимости
    интерполировать пропущенные значения
    \item Параметры модели легко интерпретируемы и позволяют исследователю быстро моделировать один и тот же процесс
    несколькими моделями
\end{enumerate}