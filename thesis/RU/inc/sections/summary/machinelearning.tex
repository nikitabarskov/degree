\subsection{Методы машинного обучения и анализ временных рядов}
\subsubsection{Основные термины и понятия}

Машинное обучение (Machine Learning) --- раздел исскуственного интеллекта, изучающий методы и алгоритмы обучения,
особенностью которых является не прямое аналитическое решение задачи, а обучение на основе накопленного опыта решений
сходных задач~\autocite{ml:definition}.

Временной ряд (Time Series) --- набор характеристик некоторого процесса, собранных в различные моменты времени.

Прогнозирование (Forecasting) --- задача предсказания характеристик процесса в будущем на основе имеющейся статистике
о данном процессе.

В данной работе рассматривается задача прогнозирования временных рядов, которая в общем случае сводится к задаче
обучения с учителем.

Обучение с учителем --- способ машинного обучения, при котором на основе известного опыта (обучающей выборки, набор
известных состояний и исходов) при помощи алгоритма машинного обучения восстанавливается закономерность между известным
состоянием системы и исходом. Общая постановка задачи может быть представлена следующим образом: на основе исходной
выборки $\left( \symbf{x}_i \right), i = \overline{1, N}, \symbf{x}_i \in X$ и известных исходов
$\left( \symbf{y}_i \right), i = \overline{1, N}, \symbf{y}_i \in Y$, найти отображение $f: X \rightarrow Y$

Период прогнозирования (Forecast Period) --- количество временных отсчетов, которые содержит прогноз.

\subsubsection{Задача прогнозирования}
В общем случае задачу прогнозирования можно поставить следующим образом ~\autocite{ml:forecasting}:
\begin{equation}
    \hat{y}_{\left.T+h\right|T} = F\left(y_0, \dots, y_T\right),
\end{equation}
\setlength{\tabcolsep}{0em}\begin{tabular}{@{\hspace*{0em}}m{\parindent}ll}
    где & $\hat{y}_{\left.T+h\right|T}\;$ & {---} оценка прогноза; \\
    & $F$ & {---} функция прогноза; \\
    & $y_i$ & {---} известные значения процесса. \\
\end{tabular}
\medskip

Выбор функции $F$ определяется следующей последовательностью действий исследователя:
\begin{enumerate}
    \item определяется какие цели преследует задача прогнозирования, кем и как прогноз будет использован и 
    каким требованиям должна соответствовать функция прогнозирования;
    \item получение исходных данных, исходной статистики процесса, параметры которого требуется предсказать;
    \item предварительный анализ данных, при котором графически оценивается исходных процесс (визуализация исходных 
    данных);
    \item на основании известной статистики, результатов предварительного исследования и требований к функции
    прогнозирования строится сравнение модели прогноза и подбор ее параметров;
    \item на последнем шаге производится проверка модели на реальных данных (back-testing) и производится ее
    доработка.
\end{enumerate}

\subsubsection{Модель прогнозирования временных рядов Prophet}

Модель прогнозирования Prophet разработана командой по изучению данный в компании Facebook~\autocite{ml:prophet}. 
Она представляет собой модульную композицию различных методов машинного обучения~\autocite{ml:modularmodel}. В качестве базовой модели в Prophet используется декомпозиция исходного временного ряда
аддитивным выражением~\autocite{ml:tsrmodel} 
\begin{equation}
    y(t) = g(t) + s(t) + h(t) + \varepsilon(t),
    \label{eq:prophet}
\end{equation}
\setlength{\tabcolsep}{0em}\begin{tabular}{@{\hspace*{0em}}m{\parindent}ll}
    где & $g(t)\;$ & {---} функция тренда; \\
    & $s(t)$ & {---} функция сезонности; \\
    & $h(t)$ & {---} функция нерегулярных событий; \\
    & $\varepsilon(t)$ & {---} невязка. \\
\end{tabular}
\medskip

В качестве функции тренда $g(t)$ выражения \eqref{eq:prophet} авторы предлагают использовать линейную модель с точками изменения, которая 
представляется в виде выражения, имеющего следующий вид:
\begin{equation}
    g(t) = \left( k + \symbf{a}(t)^T \symbf{\delta} \right)t + \left( m + \symbf{a}(t)^T \symbf{\gamma} \right)t,
\end{equation}
\setlength{\tabcolsep}{0em}\begin{tabular}{@{\hspace*{0em}}m{\parindent}ll}
    где & $k$ & {---} степень роста; \\
    & $\symbf{a}(t)\;$ & {---} единичная функция изменения тренда; \\
    & $\delta$ & {---} корректировка тренда в точках изменения; \\
    & $m$ & {---} параметр сдвига; \\
    & $\gamma$ & {---} слагаемое, необходимое для непрерывности функции тренда. \\
\end{tabular}
\medskip

Точки изменения функция тренда задаются либо параметром модели (набор временных отсчетов, в которых, по мнению
исследователя, произошло измение тренда), либо автоматически определяются моделью. Так для ряда, изображенного на 
рисунке \ref{img:impressions} функция тренда имеет следующий вид, изображенный на рисунке \ref{img:trend}.
\input{inc/images/trend.tex}

Для определения функции сезонности $s(t)$ выражения \eqref{eq:prophet} авторы используют разложение Фурье для построения модели, описывающей
периодические изменения времнного ряда.
\begin{equation}
    s(t) = \sum \limits_{n=1}^N \left( a_n \cos{\left( \dfrac{2\pi n t}{T} \right)} + b_n \sin{\left( \dfrac{2\pi n t}{T} \right)} \right),
    \label{eq:seasonality}
\end{equation}
\setlength{\tabcolsep}{0em}\begin{tabular}{@{\hspace*{0em}}m{\parindent}ll}
    где & $a_n,\; b_n\;$ & {---} коэффициенты разложения Фурье; \\
    & $T$ & {---} период сезонной компоненты. \\
\end{tabular}
\medskip

На основе предположений о различных сезонностях в исходном процессе при помощи значения периода $T$ в выражении 
\eqref{eq:seasonality} возможно моделирование нескольких периодических компонент анализируемого ряда. Сезонные 
компоненты ряда (с недельным и месячным периодами), изображенного на рисунке \eqref{img:impressions}, имеют вид, 
изображенный на рисунке \ref{img:seasonal}.
\input{inc/images/seasonal.tex}

Для построения функции внешних событий, авторы предлагают воспользоваться индикаторной функцией вида
\begin{equation}
    Z(t) = \left[ 1 (t \in D_1), \dots, 1 (t \in D_N)\right], 
\end{equation}
\setlength{\tabcolsep}{0em}\begin{tabular}{@{\hspace*{0em}}m{\parindent}ll}
    где & $D_i\;$ & {---} набор временных отсчетов $i$-ого внешнего события. \\
\end{tabular}
\medskip

Тогда компонента внещних событий разложения \eqref{eq:prophet} может быть представлена в виде \eqref{eq:externalevents}
\begin{equation}
    h(t) = Z(t)\symbf{k},
    \label{eq:externalevents}
\end{equation}
\setlength{\tabcolsep}{0em}\begin{tabular}{@{\hspace*{0em}}m{\parindent}ll}
    где & $\symbf{k}\;$ & {---} корректировка значения временного ряда для внешнего события. \\
\end{tabular}

Компонента внешних событий временного ряда, изображенного на рисунке \eqref{img:impressions}, отражены на рисунке 
\eqref{img:holidays}.
\input{inc/images/holidays.tex}

Модель Prophet схожа с аддитивной моделью (GAM, generalized additive model)~\autocite{ml:gam}. Подобная модель
предоставляет ряд преимуществ, в сравнении с классом классических моделей ARIMA~\autocite{ml:forecastintro}:
\begin{enumerate}
    \item модель Prophet является более гибкой и позволяет поддерживать одновремнно несколько периодов сезонности;
    \item отсчеты временного ряда могут быть распределены неравномерно во времени, поэтому нет необходимости
    интерполировать пропущенные значения;
    \item параметры модели легко интерпретируемы и позволяют исследователю быстро моделировать один и тот же процесс
    при помощи нескольких моделей.
\end{enumerate}